<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Virtual Dressroom</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%;
    background: #121212;
    color: silver;
    font-family: 'Arial Black', Gadget, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #splash {
    text-align: center;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100vw;
    height: 100vh;
    padding: 20px;
    user-select: none;
  }
  #splash-logo {
    width: 300px;
    max-width: 90vw;
    margin-bottom: 10px;
    filter: drop-shadow(0 0 10px silver);
  }
  #splash-text {
    font-size: 2.5rem;
    color: silver;
    text-shadow:
      2px 2px 0 #000,
      4px 4px 0 #555,
      6px 6px 10px silver;
    font-weight: 900;
    white-space: nowrap;
  }
  #probador {
    display: none;
    position: relative;
    width: 100vw;
    height: 100vh;
    background: #222;
    overflow: hidden;
  }
  canvas {
    display: block;
    position: absolute;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
  }
  #clothing-name {
    position: absolute;
    color: silver;
    bottom: 80px;
    width: 100%;
    text-align: center;
    font-size: 1.8rem;
    text-shadow:
      1px 1px 0 #000,
      2px 2px 0 #555,
      3px 3px 6px silver;
    user-select: none;
    z-index: 10;
  }
  #prev-btn, #next-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: 2px solid silver;
    color: silver;
    font-size: 1.8rem;
    padding: 15px 20px;
    cursor: pointer;
    box-shadow: 0 0 10px silver;
    user-select: none;
    transition: background 0.3s, color 0.3s;
    z-index: 10;
  }
  #prev-btn:hover, #next-btn:hover {
    background: silver;
    color: #121212;
  }
  #prev-btn { left: 10px; }
  #next-btn { right: 10px; }
  #camera-toggle {
    position: absolute;
    top: 15px;
    right: 15px;
    z-index: 10;
    background: transparent;
    border: 2px solid silver;
    color: silver;
    font-size: 1.2rem;
    padding: 8px 12px;
    cursor: pointer;
    box-shadow: 0 0 10px silver;
    user-select: none;
    transition: background 0.3s, color 0.3s;
  }
  #camera-toggle:hover {
    background: silver;
    color: #121212;
  }
</style>
</head>
<body>

<div id="splash">
  <img src="logo.png" alt="Logo" id="splash-logo" />
  <div id="splash-text">Virtual TRY-ON</div>
</div>

<div id="probador">
  <canvas id="canvas"></canvas>
  <div id="clothing-name"></div>
  <button id="prev-btn">⬅</button>
  <button id="next-btn">➡</button>
  <button id="camera-toggle">Cambiar cámara</button>
</div>

<script>
  const splash = document.getElementById('splash');
  const probador = document.getElementById('probador');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const clothingName = document.getElementById('clothing-name');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const cameraToggle = document.getElementById('camera-toggle');

  let videoStream;
  let videoTrack;
  let videoElement;
  let usingFrontCamera = true;

  // Lista de prendas
  const clothes = [
    { src: 'clothes/jacket1.png', name: 'Jacket 1' },
    { src: 'clothes/moria1.png', name: 'Moria 1' },
    { src: 'clothes/nusa1.png', name: 'Nusa 1' },
    { src: 'clothes/peixe1.png', name: 'Peixe 1' }
  ];
  let currentIndex = 0;

  // Crear video oculto para capturar cámara
  videoElement = document.createElement('video');
  videoElement.autoplay = true;
  videoElement.playsInline = true;
  videoElement.muted = true;

  function setCanvasSize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  setCanvasSize();
  window.addEventListener('resize', () => {
    setCanvasSize();
  });

  function startCamera(front = true) {
    if (videoStream) {
      videoStream.getTracks().forEach(track => track.stop());
    }
    const constraints = {
      video: { facingMode: front ? 'user' : 'environment', width: 1280, height: 720 },
      audio: false
    };
    navigator.mediaDevices.getUserMedia(constraints)
      .then(stream => {
        videoStream = stream;
        videoTrack = stream.getVideoTracks()[0];
        videoElement.srcObject = stream;
        usingFrontCamera = front;
      })
      .catch(err => alert('No se pudo acceder a la cámara: ' + err.message));
  }

  // Dibuja video + prenda
  function draw() {
    if (videoElement.readyState === videoElement.HAVE_ENOUGH_DATA) {
      // Ajustar tamaño del canvas según ventana
      setCanvasSize();

      // Espejo si es cámara frontal
      ctx.save();
      if (usingFrontCamera) {
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
      }

      // Dibuja video (imagen espejo si cámara frontal)
      ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

      // Dibuja prenda encima (ajustada a torso)
      const img = new Image();
      img.src = clothes[currentIndex].src;

      img.onload = () => {
        // Posicionamos la prenda: 
        // calculamos rectángulo torso (aprox 30%-70% vertical canvas)
        const torsoTop = canvas.height * 0.3;
        const torsoBottom = canvas.height * 0.7;
        const torsoHeight = torsoBottom - torsoTop;
        const torsoWidth = torsoHeight * (img.width / img.height); // mantener proporción

        // Centrar horizontalmente
        const x = (canvas.width - torsoWidth) / 2;
        const y = torsoTop;

        ctx.drawImage(img, x, y, torsoWidth, torsoHeight);

        ctx.restore();

        // Actualizamos nombre
        clothingName.style.bottom = (canvas.height - torsoTop) + 10 + 'px'; // justo debajo torso
        clothingName.textContent = clothes[currentIndex].name;
      }
    } else {
      // No video listo, limpiar canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Loop para animar
    requestAnimationFrame(draw);
  }

  // Cambiar prenda
  function showClothing(index) {
    currentIndex = index;
  }

  prevBtn.onclick = () => {
    currentIndex = (currentIndex - 1 + clothes.length) % clothes.length;
  }
  nextBtn.onclick = () => {
    currentIndex = (currentIndex + 1) % clothes.length;
  }

  cameraToggle.onclick = () => {
    startCamera(!usingFrontCamera);
  }

  splash.onclick = () => {
    splash.style.display = 'none';
    probador.style.display = 'block';
    startCamera(true);
    draw();
  }
</script>

</body>
</html>
